/***************************************
* @preserve
* ForeSee Client Code: Trigger
* http://www.answers.com/page/businesssolutions
* Built November 21, 16 17:36:35
* Code version: 19.1.3
* Template version: 19.1.3
***************************************/
("undefined"!=typeof _acsDefine?_acsDefine:define)(["require","_acs","triggerconfig",_acsNormalizeUrl("/trigger/fs.utils.js")],function(e,t,config,i){"string"==typeof t.startTS&&(t.startTS=i.now());var r={},s=function(e,t,r,s,n){var o={width:700,height:350,left:50,top:50,resizable:"no",scrollbar:"1",scrollbars:"1",toolbar:"no",menubar:"no",location:"0",directories:"no",status:"no"},a=i.ext(o,r),c="";for(var f in a)c+=f+"="+a[f]+",";var l=this._win=window.open(e,t,c);if(l&&n)if(l.blur(),l.opener.window.focus(),window.self.window.focus(),window.focus(),"Firefox"==s.browser.name){var u=window.open("about:blank");u.focus(),u.close()}else s.isIE&&setTimeout(function(){l.blur(),l.opener.window.focus(),window.self.window.focus(),window.focus()},1e3);return l},n=function(){var e=this;this.isOver=!0,i.Bind(document,"trigger:mouseout",function(t){t=t?t:window.event;var i=t.relatedTarget||t.toElement;i&&"HTML"!=i.nodeName||e.isOver&&(e.isOver=!1)},!1),i.Bind(document,"trigger:mouseover",function(t){e.isOver||(e.isOver=!0)},!1),i.Bind(document,"trigger:mousemove",function(t){e.isOver||(e.isOver=!0)})},o={INVITE_SHOWN:100,INVITE_ACCEPTED:101,INVITE_DECLINED:102,INVITE_ABANDONED:105,INVITE_PAGE_SHOWN:104,TRACKER_SHOWN:200,TRACKER_CLOSED:201,TRACKER_CLICKED:202,QUALIFIER_SHOWN:300,QUALIFIER_ACCEPTED:301,SURVEY_SHOWN:400,CANCEL_SHOWN:500,PURCHASE_EVENT:800,ITEMS_EVENT:801,DOLLARS_EVENT:802},a="survey.foreseeresults.com",c="events.foreseeresults.com",f=".4seeresults.com",l="i.4see.mobi",u={SERVICE_TYPES:{survey:{host:a,path:"/survey",url:"/display",protocol:"https"},mobileOnExitInitialize:{host:l,path:"/e",url:"/initialize"},mobileOnExitHeartbeat:{host:l,path:"/e",url:"/recordHeartbeat"},check:{host:"controller"+f,path:"/fsrSurvey",url:"/OTCImg",success:3},event:{host:c,path:"/rec",url:"/process?event=logit"},domain:{host:a,path:"/survey",url:"/FSRImg",success:3},replay:{host:"replaycontroller"+f,path:"/images",enabled:!0}}};u.log=function(e,t,config,r,s,n,o,a){var c=new Date,f=new i.ImageTransport,l=config.config,u=s.get("rid"),d=s.get("q"),p={ver:1,cid:l.id,rid:u,q:d,type:s.get("dn")||"",site:l.site_id,msg:n,tms:c.getTime(),tmz:6e4*c.getTimezoneOffset()};if(r&&(p.cat=r.name||"",p.sec=r.section||"",p.lang=r.language.locale||""),"object"==typeof t){p.param="";for(var h in t)p.param+=encodeURIComponent(h)+"="+encodeURIComponent(t[h])+"&"}else"string"==typeof t&&(p.param=t);for(var g in p)"undefined"!=typeof p[g]&&null!==p[g]||delete p[g];f.send({url:"https://"+e.host+e.path+(e.url||""),success:o||function(){},failure:a||function(){},data:p})},u.ping=function(e,t,r,s){var n=new i.ImageTransport,o="https://"+e.host+e.path+(e.url||"");n.send({url:o,success:r||function(){},failure:s||function(){},data:t})};var d=function(r,s,n,o,a,c,f){if(this.trig=r,this.browser=s,this.stg=n,this.cpps=o,this.events=a,this.displayoverride=c,i.isDefined(this.trig.surveydef.inviteExclude)&&i.isDefined(this.trig.crit)&&this.trig.crit.runAllTests(this.trig.surveydef.inviteExclude,this.browser,!1,!0))return!1;var l=this;u.ping(u.SERVICE_TYPES.check,{protocol:"https"},function(){e([t.makeURI("foresee/fs.invite.js")],function(e){var t=l.invite=r.invite=new e(config,r.surveydef,s,n.fstg,c,o);n.set("dn",t.display.displayname),o.set("dn",t.display.displayname),f&&f.call(l)})},function(){})};d.prototype.initialize=function(){var e=this.trig,s=this.browser,n=this.stg,a=this.cpps,c=this.events,f=(this.displayoverride,this.invite);i.Healthy(s,["survey","static"],i.proxy(function(){f.loadResources(function(){setTimeout(function(){f.present(),c.inviteShown&&c.inviteShown(e.surveydef,n,config,a),u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,n,o.INVITE_SHOWN)},Math.max(0,config.config.inviteDelay-(i.now()-t.startTS)))}),f.declined.subscribe(function(){var t=i.isDefined(config.active_surveydef)&&i.isDefined(config.active_surveydef.repeatDays)?config.active_surveydef.repeatDays:config.config.repeatDays;n.setMaxKeyExpiration(24*t.decline*60*60*1e3),c.inviteDeclined&&c.inviteDeclined(e.surveydef,n,config,a),e.surveydef.cxRecord&&r.rec&&(r.rec.cancelRecord(),e.recordController=r.rec=null),u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,n,o.INVITE_DECLINED),n.set("i","d")});var s=function(t,i){var r=new T(i,config,e.surveydef,a,n.get("rid"));r.init(t,function(){r.beginHeartbeat()})};f.abandoned.subscribe(function(){u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,n,o.INVITE_ABANDONED),n.set("i","a"),n.set("rw",i.now()+config.config.reinviteDelayAfterInviteAbandon)}),f.accepted.subscribe(function(t,l){var d=i.isDefined(config.active_surveydef)&&i.isDefined(config.active_surveydef.repeatDays)?config.active_surveydef.repeatDays:config.config.repeatDays;switch(n.setMaxKeyExpiration(24*d.accept*60*60*1e3),c.inviteAccepted&&c.inviteAccepted(e.surveydef,n,config,a),e.surveydef.cxRecord&&r.rec&&r.rec.recorder&&(r.rec.beginTransmitting(),a.set("replay_id",r.rec.recorder.logger.gsessionid),a.set("sessionid",r.rec.recorder.logger.sessionid)),u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,n,o.INVITE_ACCEPTED),n.set("i","x"),n.set("ixw",i.now()),t){case"TRACKER":e.popTracker(f);break;case"INSESSION":e.popSurvey();break;case"SMS":s(l,t);break;case"EMAIL":s(l,t);break;case"SMSEMAIL":s(l,t)}})},this),i.proxy(function(){},this))};var p=function(config,e,t){this.cfg=config,this.cpps=e,this.def=t,this.locale=e.get("locale")||"en"};p.prototype.getUrl=function(){var e=encodeURIComponent,t=this.def,r=this.cfg.config.surveyUrl+"?",s=i.now()+"_"+Math.round(1e13*Math.random()),n=t.name+"-"+(i.isDefined(t.site)?t.site+"-":"")+(i.isDefined(t.section)?this.def.section+"-":"")+this.locale,o={sid:e(n),cid:e(this.cfg.config.id),pattern:e(this.cpps.get(t.pattern)),a:s,b:i.hash(s),c:864e5,version:this.cfg.config.version};for(var a in o)r+=encodeURIComponent(a)+"="+encodeURIComponent(o[a])+"&";return r+=this.cpps.toQueryString()};var h=function(e,s,o,a,c,f,l,u){r.tracker&&(r.tracker.dispose(),r.tracker=null),r.tracker=this,i.ext(this,{template:e,def:s,cfg:o,disp:l,_fcBindings:[]}),this.mtrk=new n,this.cpps=f,this.br=u,this.stg=a,e&&c.trackerShown&&c.trackerShown(s,a,o,f);var d=i.proxy(function(e){this.stg.set("page_hb",i.now(),o.config.trackerHeartbeatTimeout,!e,i.persistDataType.TRACKER)},this);this._heartbeat=setInterval(d,Math.round(o.config.trackerHeartbeatTimeout/2)),d(!0),i.Bind(window,"unload",i.proxy(function(){this.mtrk.isOver&&this.stg.set("page_hb",i.now(),o.config.trackerHeartbeatLongTimeout,!0,i.persistDataType.TRACKER)},this));var p=encodeURIComponent;this._url=t.makeURI("foresee/fs.tracker.html?uid="+p(a.uid||"")+"&sitekey="+p(i.siteKey)+"&domain="+p(document.domain.toString())+"&stg="+p(this.stg.pers)+"&brain_url="+p(this.stg.cfg.config.brain_url)+"&fsrlocale="+p(f.get("locale")||"en")),a.fr&&a.fr.isSSL&&(this._url=this._url.replace(/http:/gi,"https:").replace(/:\d{3,4}/,""),"//"==this._url.substr(0,2)&&(this._url="https:"+this._url)),this.stg.pers==i.storageTypes.CK&&this.cpps.onSet.subscribe(i.proxy(function(e,t){var r={};r[e]=t,this.stg.set("ckcpps",r,2e5,!0,i.persistDataType.TRACKER)},this)),this._sendDefinition()};h.prototype._sendDefinition=function(){var e={method:"init",cfg:this.cfg,def:this.def};this.disp&&(e.display=this.disp),this.template&&(e.template=this.template),this.stg.set("page_hb",i.now(),this.cfg.config.trackerHeartbeatTimeout,!1,i.persistDataType.TRACKER),this.stg.set("hb_i",this.cfg.config.trackerHeartbeatTimeout,6e4,!1,i.persistDataType.TRACKER),this.stg.set("trackerinfo",e,6e4,!0,i.persistDataType.TRACKER),this.stg.pers==i.storageTypes.CK&&this.stg.set("ckcpps",this.cpps.all(),2e5,!0,i.persistDataType.TRACKER)},h.prototype.show=function(e){this.wref=s(this._url,"fsTracker",{width:700,height:450},e,!0)},h.prototype.applyExisting=function(e,t){this.wref=t,t.location=this._url},h.prototype.dispose=function(){for(var e=0;e<this._fcBindings.length;e++)this._fcBindings[e].unsubscribe();this.fstg=null};var g=function(e,config){this.stg=e,this.cfg=config};g.prototype.calcReplayPoolStatus=function(e){var t,r,s,n,o,a=this.cfg.config,c=a.replay_pools,f=window.location.toString();if(c&&0!==c.length&&this.pooloverride!==!0){if(r=this.stg.get("pl"),!i.isDefined(r))for(t=0;t<c.length;t++)s=new RegExp(c[t].path,"gi"),s.exec(f)&&(r=100*Math.random()<c[t].sp?1:0,this.stg.set("pl",r,144e5));if(n=a.replay_repools,0===r&&n&&n.length>0)for(t=0;t<n.length;t++)o=new RegExp(n[t].path,"gi"),o.exec(f)&&(r=100*Math.random()<n[t].sp?1:0,this.stg.set("pl",r,144e5));e(!!r)}else e(!0)},g.prototype.optoutCheck=function(e,t){this.stg.ready.subscribe(i.proxy(function(){this.stg.get("optout")===!0?t():e()},this),!0,!0)},g.prototype.browserCheck=function(e,t){return!(!e.isMobile&&t.config.browser_cutoff[e.browser.name]&&e.browser.actualVersion<t.config.browser_cutoff[e.browser.name])},g.prototype.featureCheck=function(e,t){return!(t.config.persistence==i.storageTypes.DS&&!e.supportsLocalStorage)},g.prototype.platformCheck=function(e,t){return!(t.config.platform_cutoff[e.os.name]&&e.os.version<t.config.platform_cutoff[e.os.name])},g.prototype.checkDeviceBlacklist=function(e,t){for(var i=0;i<t.config.device_blacklist.length;i++)if(e.agent.toLowerCase().indexOf(t.config.device_blacklist[i].toLowerCase())>-1)return!1;return!0},g.prototype._match=function(e,t,i){var r=e.include,s=e[i||"globalExclude"];if(e.criteria){if(!e.criteria.supportsSmartPhones&&!t.isTablet&&t.isMobile)return!1;if(!e.criteria.supportsTablets&&t.isTablet)return!1;if(!e.criteria.supportsDesktop&&!t.isMobile)return!1}var n=window.location.href.toString(),o=document.referrer.toString();({urls:n,referrers:o,userAgents:window.navigator.userAgent});if(s){var a=this.runAllTests(s,t,!1,!0);if(a)return!1}return!r||this.runAllTests(r,t,!1,!0)},g.prototype.runAllTests=function(e,t,r,s){function n(e,t){i.isArray(t)||(t=[t]);for(var r=0,s=t.length;r<s;r++)if("string"==typeof t[r]&&(t[r]=t[r].replace(/-_DS_-/gi,"$")),(e+"").match(t[r]))return!0;return!1}var o,a=new i.Cookie({}),c=window.location.href.toString(),f=document.referrer.toString(),l={urls:c,referrers:f,userAgents:window.navigator.userAgent};for(var u in e){var d=e[u];if(d.length>0){if(o=!1,l[u])o=n(l[u],d);else if("browsers"==u)for(var p=t.browser.name,h=t.browser.actualVersion,g=0;g<d.length;g++)p.toLowerCase().indexOf(d[g].name.toLowerCase())>-1&&(d[g].comparison?"lt"==d[g].comparison&&h<d[g].version?o=!0:"eq"==d[g].comparison&&h==d[g].version?o=!0:"gt"==d[g].comparison&&h>d[g].version&&(o=!0):o=!0);else if("cookies"==u)for(var v=0;v<d.length;v++){var y=d[v],w=a.get(y.name);i.isDefined(y.value)&&w==y.value?o=!0:!i.isDefined(y.value)&&w&&(o=!0)}else if("variables"==u)for(var m=0;m<d.length;m++){var b=d[m],T=new[].constructor.constructor("var v1 = '';try { v1 = "+b.name+"}catch(err) {}return v1;"),S=T.call(window);i.isDefined(b.value)&&S==b.value?o=!0:!i.isDefined(b.value)&&S&&(o=!0)}if(!o&&r)return!0;if(o&&s)return!0}}return!1};var v=function(e){this.cfg=e};v.prototype._bindToLink=function(e,t){for(var r=document.querySelectorAll(e.selector),s=function(e,t,r){return function(s){t.preventDefault&&i.preventDefault(s),r.call(e,t)}},n=0;n<r.length;n++){var o,a=r[n],c=!0;if(e.attribute&&(o=a.getAttribute(e.attribute),c=!1,o&&(c=!0,e.patterns&&e.patterns.length>0))){c=!1;for(var f=0;f<e.patterns.length;f++)if(o.toLowerCase().indexOf(e.patterns[f].toLowerCase())>-1){c=!0;break}}c&&i.Bind(a,"trigger:click",s(this,e,t))}},v.prototype.performBindings=function(e){if(e&&this.cfg){var t,i=this.cfg;if(i.cancel&&i.cancel.length>0){var r=function(){e.cancelTracker()};for(t=0;t<i.cancel.length;t++)this._bindToLink(i.cancel[t],r)}if(i.survey&&i.survey.length>0){var s=function(){e.popSurvey()};for(t=0;t<i.survey.length;t++)this._bindToLink(i.survey[t],s)}if(i.tracker&&i.tracker.length>0){var n=function(){e.popTracker()};for(t=0;t<i.tracker.length;t++)this._bindToLink(i.tracker[t],n)}}};var y=function(e,s,n,o,a,c){var f={},l=e.FSR||{};l.CPPS;f.CPPS=o,f.clearState=function(){s.reset()},f.getConfig=function(){return config},f.getConfigFormatted=function(){if(console&&console.info&&(console.info("************************** Trigger Configuration **************************"),console.info("Config: ",config.config),config.surveydefs&&config.surveydefs.length)){console.info("************************** Surveydefs Configuration **************************");for(var e=0;e<config.surveydefs.length;e++)console.info("************************** Surveydef "+(e+1)+" **************************"),console.info("Config: ",config.surveydefs[e])}},f.optOut=function(){var e=window.location.toString();window.location=e.indexOf("#")?e.substr(0,e.indexOf("#")-1)+"#acscommand=fsoptout":e+"#acscommand=fsoptout",window.location.reload()},f.test=function(){var e=window.location.toString();window.location=e.indexOf("#")?e.substr(0,e.indexOf("#")-1)+"#acscommand=fstest":e+"#acscommand=fstest",window.location.reload()};var u;f.run=f.pageReset=function(){u&&(clearTimeout(u),u=null),u=setTimeout(function(){var e=r.trig;e&&(e.dispose(),r.trig=null),t.startTS=i.now(),setTimeout(function(){I()},50)},250)},f.showInvite=function(e){var t=new i.Browser;t.ready.subscribe(i.proxy(function(){var i=r.trig||m(s,config,t,n,o,a,c);if(i.init()&&i.surveydef){new d(i,t,s,o,c,e,function(){this.initialize()})}},this),!0,!0)},f.getCookie=function(e){return a.get(e)},f.getKey=f.getStorage=function(e){return e?s.get(e):s};var p=config.config.publicApiName||"FSR";e[p]||(e[p]={}),i.ext(e[p],f,!1)},w=function(s,n,o,a,c,f){n&&i.isDefined(window.Uint8Array)&&a&&e([t.makeURI("foresee/fs.record.js")],function(e){c.set("cxreplayaws","true"),o.set("rc","true"),r.rec=e.getInstance(s,window,o),f&&(f.recordController=rec)})},m=function(e,config,t,i,r,s,n){var o=new b(e,config,t,i,r);return o},b=function(e,t,r,s,n){if(this.stg=e,this.cfg=t,this.browser=r,this.crit=s,this.cpps=n,!e.get("pv")){n.set("terms",this.decodeReferrer()||""),n.set("browser",r.browser.name+" "+r.browser.version),n.set("os",r.os.name),n.set("referrer",document.referrer.toString()),n.set("site",t.config.site_id),n.set("code",t.config.version),n.set("fp",r.fp),i.INT.GA.has()&&i.INT.GA.uid(function(e){e&&n.set("GA_ID",e)}),i.INT.OM.has()&&i.INT.OM.uid(function(e){e&&n.set("OMTR_VID",e)});var o=i.INT.OM.beacon();o&&n.set("OMTR_BEACON",o)}this.heartbeatExpired=new i.FSEvent};b.prototype.doesPassCriteria=function(){var e=this.crit,t=this.cfg;return!!(e.platformCheck(this.browser,t)&&e.browserCheck(this.browser,t)&&e.checkDeviceBlacklist(this.browser,t)&&e.featureCheck(this.browser,t))},b.prototype.popTracker=function(e){var t=this;if(this.stg.set("i","x"),this.didPopTrackerAlready="y"==this.stg.get("dt"),!this.didPopTrackerAlready){this.stg.set("dt","y");var i=function(){t.tracker=new h(e.template,t.surveydef,config,t.stg,config.config.events,t.cpps,e.display,t.browser),t.tracker.show(t.browser)};if(e)i();else{var r=s("about:blank","fsTracker",{width:700,height:400},this.browser,!0);new d(this,t.browser,t.stg,t.cpps,config.config.events,(!1),function(){t.tracker=new h(this.invite.template,t.surveydef,config,t.stg,config.config.events,t.cpps,this.invite.display,t.browser),t.tracker.applyExisting(t.browser,r)})}}},b.prototype.canDisplayInvitation=function(){return this.crit._match(this.cfg.config,this.browser,"inviteExclude")},b.prototype.popSurvey=function(){if(this.stg.set("i","x"),this.didPopTrackerAlready="y"==this.stg.get("dt"),this.didPopTrackerAlready)this.stg&&this.stg.fstg&&this.frm._postMessage("trackercmd",{method:"survey"});else{this.stg.set("dt","y");var e=new p(config,this.cpps,this.surveydef),t=e.getUrl();s(t,"acsSurvey",{width:700,height:400},this.browser,!0);u.log(u.SERVICE_TYPES.event,window.location.toString(),config,this.surveydef,this.stg,o.SURVEY_SHOWN)}},b.prototype.init=function(){var e,t,r,s=this.cfg.surveydefs,n=this.stg.get("def");for(e=0;e<s.length;e++)r=s[e],t&&(r=i.ext(t,r),!s[e].site&&t.site&&delete r.site,!s[e].section&&t.section&&delete r.section,s[e]=r),t=i.ext({},r);if(i.isDefined(n)&&parseInt(n)>s.length-1&&(n=void 0),i.isDefined(n)&&"default"!=s[parseInt(n)].selectMode&&"pin"!=s[parseInt(n)].selectMode){if(i.isDefined(n)||"lock"==s[parseInt(n)].selectMode)return r=s[parseInt(n)],this.cfg.active_surveydef=r,this.surveydef=r,this._setupTrueConversionIfRequired(),this.locale=this._initLocale(),this.cpps.set("locale",this.locale),r}else for(e=0;e<(i.isDefined(n)&&"default"!=s[parseInt(n)].selectMode?parseInt(n)+1:s.length);e++)if(r=s[e],i.isDefined(n)&&n==e&&"default"!=s[parseInt(n)].selectMode||this.crit._match(r,this.browser))return this.cfg.active_surveydef=r,this.surveydef=r,this._setupTrueConversionIfRequired(),this.locale=this._initLocale(),this.cpps.set("locale",this.locale),this.stg.set("def",e),r;return!1},b.prototype._initLocale=function(){var e,t=this.surveydef,r=t.language;if(i.isDefined(r.src)&&i.isDefined(r.locales)){switch(r.src){case"variable":i.isDefined(r.name)&&(e=window[r.name]);break;case"cookie":if(i.isDefined(r.name)){var s=new i.Cookie({});e=s.get(r.name)}break;case"url":var n=r.locales;if(i.isDefined(n))for(var o=0,a=n.length;o<a;o++)if(i.isDefined(n[o].locale)&&i.isDefined(n[o].match)&&location.href.match(n[o].match))return this.locale=n[o].locale,n[o].criteria&&i.ext(this.surveydef.criteria,n[o].criteria),this.locale;if(i.isDefined(r.locale))return this.locale=r.locale,this.locale}if(e)for(var c=0;c<r.locales.length;c++)if(r.locales[c].match==e)return r.locale=r.locales[c].locale,r.locales[c].criteria&&i.ext(this.surveydef.criteria,r.locales[c].criteria),this.locale=r.locale,this.locale}return"en"},b.prototype.cancelTracker=function(){this.stg&&this.stg.fstg&&this.stg.fstg._postMessage("trackercmd",{method:"close"})},b.prototype._setupTrueConversionIfRequired=function(){var r=(this.surveydef,this.cfg.config);r.trueconversion&&r.trueconversion.enabled&&e([t.makeURI("foresee/fs.trueconversion.js")],i.proxy(function(e){this.trueconversion=new e(this,u)},this))},b.prototype.logState=function(){this.pageViewCount=(this.stg.get("pv")||0)+1,this.stg.set("pv",this.pageViewCount)},b.prototype.logDefState=function(){this.surveydef&&(this.defPageViewCount=(this.stg.get(this.surveydef.name+"pv")||0)+1,this.stg.set(this.surveydef.name+"pv",this.defPageViewCount))},b.prototype.evalLoyaltySampling=function(){var e=this.surveydef,t=this.stg.get("pl"),r=i.isDefined(t)&&1!=t?e.criteria.sp.outreplaypool||0:e.criteria.sp.reg||0,s=100*Math.random();return this.defPageViewCount>=e.criteria.lf&&s<=r},b.prototype.decodeReferrer=function(){var e,t,i=document.referrer||"",r=null,s=["q","p","query"];for(t=0;t<s.length&&!(r=i.match(new RegExp("[?&]"+s[t]+"=([^&]*)")));t++);return r?(e=decodeURIComponent(r[1]),e&&(e=e.replace(/\+/g," ")),e):e},b.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.trueconversion&&this.trueconversion.dispose(),this.invite&&this.invite.dispose(),r.rec&&(r.rec.dispose(),r.rec=null),i.Unbind("trigger:*"))};var T=function(e,t,r,s,n){this.itype=e,this.cfg=t,this.def=r,this.cpps=s,this.rid=n,this._measureName=this.def.name+"-"+(i.isDefined(this.def.site)?this.def.site+"-":"")+(i.isDefined(this.def.section)?this.def.section+"-":"")+this.def.language.locale};T.prototype.init=function(e,t){t=t||function(){};var r=i.now()+"_"+Math.round(1e13*Math.random());u.ping(u.SERVICE_TYPES.mobileOnExitInitialize,{a:r,notify:e,b:i.hash(r),c:864e5,cid:this.cfg.config.id,sid:this._measureName,rid:this.rid,uid:i.now(),support:"SMSEMAIL"==this.itype?"b":"EMAIL"==this.itype?"e":"s",cpps:"version="+encodeURIComponent(this.cfg.config.version)+"&"+this.cpps.toQueryString()},t,t)},T.prototype.beginHeartbeat=function(){this._timer&&(clearTimeout(this._timer),this._timer=null);var e=i.proxy(function(){u.ping(u.SERVICE_TYPES.mobileOnExitHeartbeat,{cid:this.cfg.config.id,sid:this._measureName,rid:this.rid,uid:i.now()},function(){},function(){})},this);this._timer=setInterval(e,config.config.onExitMobileHeartbeatInterval),e()},i.registerProduct("foresee",config);var S=config.config.events,_=window!=window.top;if(S.loaded&&S.loaded(),("dontRunOtherIframes"!==config.config.workInIframes&&config.config.workInIframes||!_)&&!(window.__fsrtracker||window.location.toString().indexOf("survey.foreseeresults.com")>-1)){var E=window.location,I=function(){E=JSON.parse(JSON.stringify(window.location));var e=new i.Browser;e.ready.subscribe(function(){var s,n,o=i.getGlobalStore(config,e),a=new g(o,config),c=new i.CPPS(o),f=new i.Cookie({path:"/",secure:!1,encode:!0});y(window,o,a,c,f,S),o.ready.subscribe(i.proxy(function(){var l=o.get("i");setTimeout(i.proxy(function(){if(c.set("url",window.location.toString()),config.config.cpps){var t,u=config.config.cpps;for(var p in u){var g=u[p];if(i.isObject(g))switch(g.source){case"param":var y=i.getParam(g.val)||g.init||null;if(i.isDefined(g.mode)&&"append"==g.mode){var b=g.delimiter||",",T=c.get(p),E=T?T.split(b):[];y=y||"",E[E.length-1]!==y&&(E.push(y),E.join(b),c.set(p,E))}else i.isDefined(y)&&null!==y?c.set(p,y):c.get(p)||c.set(p,"");break;case"variable":if(i.isDefined(g.name)){for(var I=window,k=g.name.split("."),C=0;C<k.length&&I;)I=I[k[C++]];C==k.length&&i.isDefined(I)?c.set(p,I):c.get(p)||c.set(p,g.init||"")}break;case"cookie":var D=f.get(g.val);i.isDefined(D)&&null!==D?c.set(p,D):c.get(p)||c.set(p,g.init||"");break;case"url":for(var R=0,x=g.patterns.length;R<x;R++)t=g.patterns[R].value,i.isString(location.href)&&location.href.match(g.patterns[R].regex)?c.set(p,t):c.get(p)||c.set(p,g.init||"");break;case"function":if(i.isFunction(g.value))try{t=g.value.call(window),c.set(p,t)}catch(e){}}else c.set(p,g)}}var A;if(o.get("ovr")&&(A=JSON.parse(o.get("ovr"))),A){for(var O=0;O<config.surveydefs.length;O++){var N=config.surveydefs[O].name;A.sp[N]&&(config.surveydefs[O].criteria.sp=A.sp[N]),A.lf[N]&&(config.surveydefs[O].criteria.lf=A.lf[N])}A.pooloverride===!0&&(a.pooloverride=!0)}if("a"==l){var M=parseInt(o.get("rw"));M<i.now()&&(o.erase("i"),o.erase("rw"),l=null)}if("runRecordOnly"===config.config.workInIframes&&_){for(var P=!1,L=0;L<config.surveydefs.length;L++){var V=config.surveydefs[L].cxRecord;if(V){P=!0;break}}return void w(e,P,o,!0,c)}if("d"!=l&&"a"!=l)a.calcReplayPoolStatus(function(t){a.optoutCheck(i.proxy(function(){if(a._match(config.config,e,"globalExclude")&&"y"!=o.get("gx")){var u=r.trig=m(o,config,e,a,c,f,S);if(u.logState(),c.set("pv",u.pageViewCount),u.init()&&(S.initialized&&S.initialized(c),u.doesPassCriteria()&&u.surveydef)){if(u.logDefState(),w(e,u.surveydef.cxRecord,o,t,c),"x"!=l){if(u.evalLoyaltySampling()&&u.canDisplayInvitation()){new d(u,e,o,c,S,(!1),function(){this.initialize()})}}else s=new h(null,u.surveydef,config,o,S,c,null,e),u.surveydef&&o.set("defupdate",{name:u.surveydef.name},2e4,!0,i.persistDataType.TRACKER);u.surveydef.links&&(n=new v(u.surveydef.links),n.performBindings(u))}}else o.set("gx","y")},this),function(){})});else if("a"==l){var U="true"==o.get("rc")||o.get("rc")===!0;w(e,U,o,U,c)}},this),Math.max(0,config.config.triggerDelay-(i.now()-t.startTS)))},this),!0,!0)},!0,!0)};t.domReady(I);var k;i.pageNavEvent.subscribe(function(){var e=window,t=e.location,i=e[config.config.publicApiName||"FSR"],r=function(e){var t=e.split("#");return t.length>2?t[0]+t[1]:e.replace(/#/gi,"")},s=r(E.hash),n=r(t.hash);(i&&s!=n||E.pathname!=t.pathname)&&acsReady(function(){clearTimeout(k),k=setTimeout(function(){i.pageReset()},1500)})},!1,!1)}});